{"title":"Normalize Selected Arrows","uid":"94dd5736dc50981b37c31780ed9dd77f","slug":"Normalize Selected Arrows","date":"2023-07-29T10:00:19.277Z","updated":"2023-07-29T10:00:19.395Z","comments":true,"path":"api/articles/Normalize Selected Arrows.json","keywords":"Digital Garden","cover":[],"content":"<p>&#x2F;*<br><img src=\"https://raw.githubusercontent.com/zsviczian/obsidian-excalidraw-plugin/master/images/scripts-normalize-selected-arrows.png\"></p>\n<p>This script will reset the start and end positions of the selected arrows. The arrow will point to the center of the connected box and will have a gap of 8px from the box.</p>\n<p>Tips: If you are drawing a flowchart, you can use <code>Normalize Selected Arrows</code> script to correct the position of the start and end points of the arrows, then use <code>Elbow connectors</code> script, and you will get the perfect connecting line!</p>\n<pre><code class=\"javascript\">*/\nif(!ea.verifyMinimumPluginVersion || !ea.verifyMinimumPluginVersion(&quot;1.5.21&quot;)) &#123;\n  new Notice(&quot;This script requires a newer version of Excalidraw. Please install the latest version.&quot;);\n  return;\n&#125;\nsettings = ea.getScriptSettings();\n//set default values on first run\nif(!settings[&quot;Gap&quot;]) &#123;\n    settings = &#123;\n      &quot;Gap&quot; : &#123;\n            value: 8,\n          description: &quot;The value of the gap between the connection line and the element, which must be greater than 0. If you want the connector to be next to the element, set it to 1.&quot;\n        &#125;\n    &#125;;\n    ea.setScriptSettings(settings);\n&#125;\n\nlet gapValue = settings[&quot;Gap&quot;].value;\n\nconst selectedIndividualArrows = ea.getMaximumGroups(ea.getViewSelectedElements())\n    .reduce((result, g) =&gt; [...result, ...g.filter(el =&gt; el.type === &#39;arrow&#39;)], []);\n\nconst allElements = ea.getViewElements();\nfor(const arrow of selectedIndividualArrows) &#123;\n    const startBindingEl = allElements.filter(el =&gt; el.id === (arrow.startBinding||&#123;&#125;).elementId)[0];\n    const endBindingEl = allElements.filter(el =&gt; el.id === (arrow.endBinding||&#123;&#125;).elementId)[0];\n\n    if(startBindingEl) &#123;\n        recalculateStartPointOfLine(arrow, startBindingEl, endBindingEl, gapValue);\n    &#125;\n    if(endBindingEl) &#123;\n        recalculateEndPointOfLine(arrow, endBindingEl, startBindingEl, gapValue);\n    &#125;\n&#125;\n\nea.copyViewElementsToEAforEditing(selectedIndividualArrows);\nawait ea.addElementsToView(false,false);\n\nfunction recalculateStartPointOfLine(line, el, elB, gapValue) &#123;\n    const aX = el.x + el.width/2;\n    const bX = (line.points.length &lt;=2 &amp;&amp; elB) ? elB.x + elB.width/2 : line.x + line.points[1][0];\n    const aY = el.y + el.height/2;\n    const bY = (line.points.length &lt;=2 &amp;&amp; elB) ? elB.y + elB.height/2 : line.y + line.points[1][1];\n\n    line.startBinding.gap = gapValue;\n    line.startBinding.focus = 0;\n    const intersectA = ea.intersectElementWithLine(\n                el,\n                [bX, bY],\n                [aX, aY],\n                line.startBinding.gap\n              );\n\n    if(intersectA.length &gt; 0) &#123;\n        line.points[0] = [0, 0];\n        for(var i = 1; i&lt;line.points.length; i++) &#123;\n            line.points[i][0] -= intersectA[0][0] - line.x;\n            line.points[i][1] -= intersectA[0][1] - line.y;\n        &#125;\n        line.x = intersectA[0][0];\n        line.y = intersectA[0][1];\n    &#125;\n&#125;\n\nfunction recalculateEndPointOfLine(line, el, elB, gapValue) &#123;\n    const aX = el.x + el.width/2;\n    const bX = (line.points.length &lt;=2 &amp;&amp; elB) ? elB.x + elB.width/2 : line.x + line.points[line.points.length-2][0];\n    const aY = el.y + el.height/2;\n    const bY = (line.points.length &lt;=2 &amp;&amp; elB) ? elB.y + elB.height/2 : line.y + line.points[line.points.length-2][1];\n\n    line.endBinding.gap = gapValue;\n    line.endBinding.focus = 0;\n    const intersectA = ea.intersectElementWithLine(\n                el,\n                [bX, bY],\n                [aX, aY],\n                line.endBinding.gap\n              );\n\n    if(intersectA.length &gt; 0) &#123;\n        line.points[line.points.length - 1] = [intersectA[0][0] - line.x, intersectA[0][1] - line.y];\n    &#125;\n&#125;\n</code></pre>\n","text":"&#x2F;* This script will reset the start and end positions of the selected arrows. The arrow will point to the center of the connected box a...","link":"","photos":[],"count_time":{"symbolsCount":"3.8k","symbolsTime":"3 mins."},"categories":[],"tags":[],"toc":"","author":{"name":"Devmacy","slug":"blog-author","avatar":"https://s1.ax1x.com/2023/01/24/pSYhwB4.jpg","link":"/","description":"数字花园","socials":{"github":"https://github.com/Devmacy","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"Organic Line","uid":"9d7a3d3fc9a4ed838ec1aaa19f2b5092","slug":"Organic Line","date":"2023-07-29T10:00:19.279Z","updated":"2023-07-29T10:00:19.397Z","comments":true,"path":"api/articles/Organic Line.json","keywords":"Digital Garden","cover":[],"text":"&#x2F;* Converts selected freedraw lines such that pencil pressure will decrease from maximum to minimum from the beginning of the line to i...","link":"","photos":[],"count_time":{"symbolsCount":"2.7k","symbolsTime":"2 mins."},"categories":[],"tags":[],"author":{"name":"Devmacy","slug":"blog-author","avatar":"https://s1.ax1x.com/2023/01/24/pSYhwB4.jpg","link":"/","description":"数字花园","socials":{"github":"https://github.com/Devmacy","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"Modify background color opacity","uid":"8fc5f303927e140b24df3a557a9ee147","slug":"Modify background color opacity","date":"2023-07-29T10:00:19.275Z","updated":"2023-07-29T10:00:19.394Z","comments":true,"path":"api/articles/Modify background color opacity.json","keywords":"Digital Garden","cover":[],"text":"&#x2F;* Download this file and save to your Obsidian Vault including the first line, or open it in “Raw” and copy the entire contents to Obs...","link":"","photos":[],"count_time":{"symbolsCount":"9.7k","symbolsTime":"9 mins."},"categories":[],"tags":[],"author":{"name":"Devmacy","slug":"blog-author","avatar":"https://s1.ax1x.com/2023/01/24/pSYhwB4.jpg","link":"/","description":"数字花园","socials":{"github":"https://github.com/Devmacy","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}}}