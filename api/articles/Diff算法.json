{"title":"Diff算法","uid":"5173d8993970310ffc7f92fe7bccdac0","slug":"Diff算法","date":"2023-07-07T17:47:16.028Z","updated":"2023-07-07T17:47:16.217Z","comments":true,"path":"api/articles/Diff算法.json","keywords":"Digital Garden","cover":[],"content":"<p>#Vue</p>\n<h1 id=\"真实-dom\"><a href=\"#真实-dom\" class=\"headerlink\" title=\"真实 dom\"></a>真实 dom</h1>  <pre class=\"line-numbers language-markup\" data-language=\"markup\"><code class=\"language-markup\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">></span></span>123<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n\n<h1 id=\"虚拟-dom\"><a href=\"#虚拟-dom\" class=\"headerlink\" title=\"虚拟 dom\"></a>虚拟 dom</h1>  <pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">var</span> Vnode <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span>\n <span class=\"token literal-property property\">tag</span><span class=\"token operator\">:</span> <span class=\"token string\">'div'</span><span class=\"token punctuation\">,</span>\n <span class=\"token literal-property property\">children</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n  <span class=\"token punctuation\">&#123;</span> <span class=\"token literal-property property\">tag</span><span class=\"token operator\">:</span> <span class=\"token string\">'p'</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">text</span><span class=\"token operator\">:</span> <span class=\"token string\">'123'</span> <span class=\"token punctuation\">&#125;</span>\n <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h1 id=\"vnode-分类\"><a href=\"#vnode-分类\" class=\"headerlink\" title=\"vnode 分类\"></a>vnode 分类</h1><h2 id=\"EmptyVNode\"><a href=\"#EmptyVNode\" class=\"headerlink\" title=\"EmptyVNode\"></a>EmptyVNode</h2><p>没有内容的注释节点</p>\n<h2 id=\"TextVNode\"><a href=\"#TextVNode\" class=\"headerlink\" title=\"TextVNode\"></a>TextVNode</h2><p>文本节点</p>\n<h2 id=\"ElementVNode\"><a href=\"#ElementVNode\" class=\"headerlink\" title=\"ElementVNode\"></a>ElementVNode</h2><p>普通元素节点</p>\n<h2 id=\"ComponentVNode\"><a href=\"#ComponentVNode\" class=\"headerlink\" title=\"ComponentVNode\"></a>ComponentVNode</h2><p>组件节点</p>\n<h2 id=\"CloneVNode\"><a href=\"#CloneVNode\" class=\"headerlink\" title=\"CloneVNode\"></a>CloneVNode</h2><p>克隆节点，可以是以上任意类型的节点，唯一的区别在于 isCloned 属性为 true</p>\n<h1 id=\"流程\"><a href=\"#流程\" class=\"headerlink\" title=\"流程\"></a>流程</h1><ol>\n<li>真实 dom 生成一个虚拟 dom</li>\n<li>虚拟 dom 节点数据变化之后生成一个新的 vnode</li>\n<li>vnode 和 oldNode 比较，发现有不一样的地方直接修改在真实 dom 上</li>\n<li>将 oldnode 修改为 vnode</li>\n</ol>\n<h1 id=\"比较方式\"><a href=\"#比较方式\" class=\"headerlink\" title=\"比较方式\"></a>比较方式</h1><ul>\n<li><img src=\"https://images2018.cnblogs.com/blog/998023/201805/998023-20180519212338609-1617459354.png\"></li>\n</ul>\n  <pre class=\"line-numbers language-markup\" data-language=\"markup\"><code class=\"language-markup\">// 旧dom\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">></span></span>123<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n\n// 新dom\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>span</span><span class=\"token punctuation\">></span></span>456<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>span</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<ul>\n<li>边比较边更新</li>\n<li>生成一个新的 vdom 树</li>\n<li>如果认为两个 vnode 节点<ul>\n<li><p>值得比较</p>\n<ul>\n<li>继续比较其子节点</li>\n</ul>\n</li>\n<li><p>不值得比较</p>\n<ul>\n<li>删除旧节点</li>\n<li>插入新节点</li>\n</ul>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">patch</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">oldVnode<span class=\"token punctuation\">,</span> vnode</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">sameVnode</span><span class=\"token punctuation\">(</span>oldVnode<span class=\"token punctuation\">,</span> vnode<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n<span class=\"token function\">patchVnode</span><span class=\"token punctuation\">(</span>oldVnode<span class=\"token punctuation\">,</span> vnode<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span>\n<span class=\"token keyword\">const</span> oEl <span class=\"token operator\">=</span> oldVnode<span class=\"token punctuation\">.</span>el\n<span class=\"token keyword\">let</span> parentEle <span class=\"token operator\">=</span> api<span class=\"token punctuation\">.</span><span class=\"token function\">parentNode</span><span class=\"token punctuation\">(</span>oEl<span class=\"token punctuation\">)</span>\n<span class=\"token function\">createEle</span><span class=\"token punctuation\">(</span>vnode<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>parentEle <span class=\"token operator\">!==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\napi<span class=\"token punctuation\">.</span><span class=\"token function\">insertBefore</span><span class=\"token punctuation\">(</span>parentEle<span class=\"token punctuation\">,</span> vnode<span class=\"token punctuation\">.</span>el<span class=\"token punctuation\">,</span> api<span class=\"token punctuation\">.</span><span class=\"token function\">nextSibling</span><span class=\"token punctuation\">(</span>oEl<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\napi<span class=\"token punctuation\">.</span><span class=\"token function\">removeChild</span><span class=\"token punctuation\">(</span>parentEle<span class=\"token punctuation\">,</span> oldVnode<span class=\"token punctuation\">.</span>el<span class=\"token punctuation\">)</span>\noldVnode <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span>\n<span class=\"token punctuation\">&#125;</span>\n<span class=\"token punctuation\">&#125;</span>\n<span class=\"token keyword\">return</span> vnode\n<span class=\"token punctuation\">&#125;</span>\n\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">sameVnode</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">oldVnode<span class=\"token punctuation\">,</span> vnode</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span>\n<span class=\"token comment\">// 两节点key值相同，并且sel属性值相同，即认为两节点属同一类型，可进行下一步比较</span>\n<span class=\"token keyword\">return</span> vnode<span class=\"token punctuation\">.</span>key <span class=\"token operator\">===</span> oldVnode<span class=\"token punctuation\">.</span>key <span class=\"token operator\">&amp;&amp;</span> vnode<span class=\"token punctuation\">.</span>sel <span class=\"token operator\">===</span> oldVnode<span class=\"token punctuation\">.</span>sel\n<span class=\"token punctuation\">&#125;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>\n</ul>\n</li>\n</ul>\n","text":"#Vue 真实 dom &lt;div> &lt;p>123&lt;/p> &lt;/div> 虚拟 dom var Vnode = &#123; tag: 'div', children: [ &#123; tag: 'p', text: '123' &#125; ] &#12...","link":"","photos":[],"count_time":{"symbolsCount":"1.1k","symbolsTime":"1 mins."},"categories":[],"tags":[{"name":"Vue","slug":"Vue","count":5,"path":"api/tags/Vue.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E7%9C%9F%E5%AE%9E-dom\"><span class=\"toc-text\">真实 dom</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E8%99%9A%E6%8B%9F-dom\"><span class=\"toc-text\">虚拟 dom</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#vnode-%E5%88%86%E7%B1%BB\"><span class=\"toc-text\">vnode 分类</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#EmptyVNode\"><span class=\"toc-text\">EmptyVNode</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#TextVNode\"><span class=\"toc-text\">TextVNode</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#ElementVNode\"><span class=\"toc-text\">ElementVNode</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#ComponentVNode\"><span class=\"toc-text\">ComponentVNode</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#CloneVNode\"><span class=\"toc-text\">CloneVNode</span></a></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E6%B5%81%E7%A8%8B\"><span class=\"toc-text\">流程</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E6%AF%94%E8%BE%83%E6%96%B9%E5%BC%8F\"><span class=\"toc-text\">比较方式</span></a></li></ol>","author":{"name":"Devmacy","slug":"blog-author","avatar":"https://s1.ax1x.com/2023/01/24/pSYhwB4.jpg","link":"/","description":"数字花园","socials":{"github":"https://github.com/Devmacy","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"display","uid":"f7781a311adfe6b89739c305ab02cd69","slug":"display","date":"2023-07-07T17:47:16.030Z","updated":"2023-07-07T17:47:16.217Z","comments":true,"path":"api/articles/display.json","keywords":"Digital Garden","cover":null,"text":"#CSS ","link":"","photos":[],"count_time":{"symbolsCount":5,"symbolsTime":"1 mins."},"categories":[],"tags":[{"name":"CSS","slug":"CSS","count":21,"path":"api/tags/CSS.json"}],"author":{"name":"Devmacy","slug":"blog-author","avatar":"https://s1.ax1x.com/2023/01/24/pSYhwB4.jpg","link":"/","description":"数字花园","socials":{"github":"https://github.com/Devmacy","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"devicePixelRatio","uid":"6b187a3dcaca4b22050a31027cd39624","slug":"devicePixelRatio","date":"2023-07-07T17:47:16.026Z","updated":"2023-07-07T17:47:16.216Z","comments":true,"path":"api/articles/devicePixelRatio.json","keywords":"Digital Garden","cover":null,"text":"#HTML 概述 devicePixelRatio 返回当前显示设备的 物理像素分辨率与 CSS 像素分辨率之比。 此值也可以解释为像素大小的比率：一个 CSS 像素的大小与一个物理像素的大小。简单来说，它告诉浏览器应使用多少屏幕实际像素来绘制单个 CSS 像素。 语法value...","link":"","photos":[],"count_time":{"symbolsCount":355,"symbolsTime":"1 mins."},"categories":[],"tags":[{"name":"HTML","slug":"HTML","count":14,"path":"api/tags/HTML.json"}],"author":{"name":"Devmacy","slug":"blog-author","avatar":"https://s1.ax1x.com/2023/01/24/pSYhwB4.jpg","link":"/","description":"数字花园","socials":{"github":"https://github.com/Devmacy","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}}}