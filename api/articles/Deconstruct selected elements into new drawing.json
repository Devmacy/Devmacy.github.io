{"title":"Deconstruct selected elements into new drawing","uid":"bfb83d2abca559002f1f33b5507b19ba","slug":"Deconstruct selected elements into new drawing","date":"2023-07-29T10:00:19.231Z","updated":"2023-07-29T10:00:19.354Z","comments":true,"path":"api/articles/Deconstruct selected elements into new drawing.json","keywords":"Digital Garden","cover":[],"content":"<p>&#x2F;*<br><img src=\"https://raw.githubusercontent.com/zsviczian/obsidian-excalidraw-plugin/master/images/scripts-deconstruct.jpg\"></p>\n<p>Select some elements in the scene. The script will take these elements and move them into a new Excalidraw file, and open that file. The selected elements will also be replaced in your original drawing with the embedded Excalidraw file (the one that was just created). You will be prompted for the file name of the new deconstructed image. The script is useful if you want to break a larger drawing into smaller reusable parts that you want to reference in multiple drawings.</p>\n<pre><code class=\"javascript\">*/\nif(!ea.verifyMinimumPluginVersion || !ea.verifyMinimumPluginVersion(&quot;1.7.29&quot;)) &#123;\n  new Notice(&quot;This script requires a newer version of Excalidraw. Please install the latest version.&quot;);\n  return;\n&#125;\n\nconst els = ea.getViewSelectedElements();\nif (els.length === 0) &#123;\n  new Notice(&quot;You must select elements first&quot;)\n  return;\n&#125;\n\nconst bb = ea.getBoundingBox(els);\nea.copyViewElementsToEAforEditing(els);\n\nea.getElements().filter(el=&gt;el.type===&quot;image&quot;).forEach(el=&gt;&#123;\n    const img = ea.targetView.excalidrawData.getFile(el.fileId);\n    const path = (img?.linkParts?.original)??(img?.file?.path);\n    if(img &amp;&amp; path) &#123;\n        ea.imagesDict[el.fileId] = &#123;\n          mimeType: img.mimeType,\n          id: el.fileId,\n          dataURL: img.img,\n          created: img.mtime,\n          file: path,\n          hasSVGwithBitmap: img.isSVGwithBitmap,\n          latex: null,\n        &#125;;\n        return;\n    &#125;\n    const equation = ea.targetView.excalidrawData.getEquation(el.fileId);\n    eqImg = ea.targetView.getScene()?.files[el.fileId]\n    if(equation &amp;&amp; eqImg) &#123;\n          ea.imagesDict[el.fileId] = &#123;\n          mimeType: eqImg.mimeType,\n          id: el.fileId,\n          dataURL: eqImg.dataURL,\n          created: eqImg.created,\n          file: null,\n          hasSVGwithBitmap: null,\n          latex: equation.latex,\n        &#125;;\n        return;\n    &#125;\n&#125;);\n\nlet folder = ea.targetView.file.path;\nfolder = folder.lastIndexOf(&quot;/&quot;)===-1?&quot;&quot;:folder.substring(0,folder.lastIndexOf(&quot;/&quot;))+&quot;/&quot;;\nconst fname = await utils.inputPrompt(&quot;Filename for new file&quot;,&quot;Filename&quot;,&quot;&quot;);\nconst template = app.metadataCache.getFirstLinkpathDest(ea.plugin.settings.templateFilePath,&quot;&quot;);\n\nconst newPath = await ea.create (&#123;\n  filename: fname + &quot;.md&quot;,\n  foldername: folder,\n  templatePath: template?.path,\n  onNewPane: true\n&#125;);\n\nsetTimeout(async ()=&gt;&#123;\n  const file = app.metadataCache.getFirstLinkpathDest(newPath,&quot;&quot;)\n  ea.deleteViewElements(els);\n  ea.clear();\n  await ea.addImage(bb.topX,bb.topY,file,false);\n  await ea.addElementsToView(false, true, true);\n  ea.getExcalidrawAPI().history.clear(); //to avoid undo/redo messing up the decomposition\n&#125;,1000);\n</code></pre>\n","text":"&#x2F;* Select some elements in the scene. The script will take these elements and move them into a new Excalidraw file, and open that file....","link":"","photos":[],"count_time":{"symbolsCount":"2.9k","symbolsTime":"3 mins."},"categories":[],"tags":[],"toc":"","author":{"name":"Devmacy","slug":"blog-author","avatar":"https://s1.ax1x.com/2023/01/24/pSYhwB4.jpg","link":"/","description":"数字花园","socials":{"github":"https://github.com/Devmacy","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"Elbow connectors","uid":"13ea30ebd17055cb9b81ab0b3e2c7a26","slug":"Elbow connectors","date":"2023-07-29T10:00:19.233Z","updated":"2023-07-29T10:00:19.357Z","comments":true,"path":"api/articles/Elbow connectors.json","keywords":"Digital Garden","cover":[],"text":"&#x2F;* Download this file and save to your Obsidian Vault including the first line, or open it in “Raw” and copy the entire contents to Obs...","link":"","photos":[],"count_time":{"symbolsCount":"3.2k","symbolsTime":"3 mins."},"categories":[],"tags":[],"author":{"name":"Devmacy","slug":"blog-author","avatar":"https://s1.ax1x.com/2023/01/24/pSYhwB4.jpg","link":"/","description":"数字花园","socials":{"github":"https://github.com/Devmacy","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"Darken background color","uid":"a15dff4ffc3433ec8c52c4869839aa7a","slug":"Darken background color","date":"2023-07-29T10:00:19.228Z","updated":"2023-07-29T10:00:19.352Z","comments":true,"path":"api/articles/Darken background color.json","keywords":"Digital Garden","cover":[],"text":"&#x2F;* Download this file and save to your Obsidian Vault including the first line, or open it in “Raw” and copy the entire contents to Obs...","link":"","photos":[],"count_time":{"symbolsCount":"1.9k","symbolsTime":"2 mins."},"categories":[],"tags":[],"author":{"name":"Devmacy","slug":"blog-author","avatar":"https://s1.ax1x.com/2023/01/24/pSYhwB4.jpg","link":"/","description":"数字花园","socials":{"github":"https://github.com/Devmacy","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}}}