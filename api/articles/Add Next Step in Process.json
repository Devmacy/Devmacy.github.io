{"title":"Add Next Step in Process","uid":"596ec896ae628dddf8ba2d8237bc03cd","slug":"Add Next Step in Process","date":"2023-07-29T10:00:19.201Z","updated":"2023-07-29T10:00:19.334Z","comments":true,"path":"api/articles/Add Next Step in Process.json","keywords":"Digital Garden","cover":[],"content":"<p>&#x2F;*<br><img src=\"https://raw.githubusercontent.com/zsviczian/obsidian-excalidraw-plugin/master/images/scripts-add-process-step.jpg\"></p>\n<p>This script will prompt you for the title of the process step, then will create a stick note with the text. If an element is selected then the script will connect this new step with an arrow to the previous step (the selected element). If no element is selected, then the script assumes this is the first step in the process and will only output the sticky note with the text that was entered.</p>\n<pre><code class=\"javascript\">*/\n\nif(!ea.verifyMinimumPluginVersion || !ea.verifyMinimumPluginVersion(&quot;1.5.24&quot;)) &#123;\n  new Notice(&quot;This script requires a newer version of Excalidraw. Please install the latest version.&quot;);\n  return;\n&#125;\n\nsettings = ea.getScriptSettings();\n//set default values on first run\nif(!settings[&quot;Starting arrowhead&quot;]) &#123;\n    settings = &#123;\n      &quot;Starting arrowhead&quot; : &#123;\n            value: &quot;none&quot;,\n      valueset: [&quot;none&quot;,&quot;arrow&quot;,&quot;triangle&quot;,&quot;bar&quot;,&quot;dot&quot;]\n        &#125;,\n        &quot;Ending arrowhead&quot; : &#123;\n            value: &quot;triangle&quot;,\n      valueset: [&quot;none&quot;,&quot;arrow&quot;,&quot;triangle&quot;,&quot;bar&quot;,&quot;dot&quot;]\n        &#125;,\n        &quot;Line points&quot; : &#123;\n            value: 0,\n      description: &quot;Number of line points between start and end&quot;\n        &#125;,\n        &quot;Gap between elements&quot;: &#123;\n            value: 100\n        &#125;,\n        &quot;Wrap text at (number of characters)&quot;: &#123;\n            value: 25,\n        &#125;,\n        &quot;Fix width&quot;: &#123;\n            value: true,\n            description: &quot;The object around the text should have fix width to fit the wrapped text&quot;\n        &#125;\n    &#125;;\n    ea.setScriptSettings(settings);\n&#125;\n\nconst arrowStart = settings[&quot;Starting arrowhead&quot;].value === &quot;none&quot; ? null : settings[&quot;Starting arrowhead&quot;].value;\nconst arrowEnd = settings[&quot;Ending arrowhead&quot;].value === &quot;none&quot; ? null : settings[&quot;Ending arrowhead&quot;].value;\n\n// workaround until https://github.com/zsviczian/obsidian-excalidraw-plugin/issues/388 is fixed\nif (!arrowEnd) ea.style.endArrowHead = null;\nif (!arrowStart) ea.style.startArrowHead = null;\n\nconst linePoints = Math.floor(settings[&quot;Line points&quot;].value);\nconst gapBetweenElements = Math.floor(settings[&quot;Gap between elements&quot;].value);\nconst wrapLineLen = Math.floor(settings[&quot;Wrap text at (number of characters)&quot;].value);\nconst fixWidth = settings[&quot;Fix width&quot;];\n\nconst textPadding = 10;\nconst text = await utils.inputPrompt(&quot;Text?&quot;);\nconst elements = ea.getViewSelectedElements();\nconst isFirst = (!elements || elements.length === 0);\n\nconst width = ea.measureText(&quot;w&quot;.repeat(wrapLineLen)).width;\n\nlet id = &quot;&quot;;\n\nif(!isFirst) &#123;\n  const fromElement = ea.getLargestElement(elements);\n  ea.copyViewElementsToEAforEditing([fromElement]);\n\n  const previousTextElements = elements.filter((el)=&gt;el.type===&quot;text&quot;);\n  const previousRectElements = elements.filter((el)=&gt; [&#39;ellipse&#39;, &#39;rectangle&#39;, &#39;diamond&#39;].includes(el.type));\n  if(previousTextElements.length&gt;0) &#123;\n    const el = previousTextElements[0];\n    ea.style.strokeColor = el.strokeColor;\n    ea.style.fontSize    = el.fontSize;\n    ea.style.fontFamily  = el.fontFamily;\n  &#125;\n\n    textWidth = ea.measureText(text).width;\n\n  id = ea.addText(\n    fixWidth\n    ? fromElement.x+fromElement.width/2-width/2\n    : fromElement.x+fromElement.width/2-textWidth/2-textPadding,\n    fromElement.y+fromElement.height+gapBetweenElements,\n    text,\n    &#123;\n      wrapAt: wrapLineLen,\n      textAlign: &quot;center&quot;,\n      textVerticalAlign: &quot;middle&quot;,\n      box: previousRectElements.length &gt; 0 ? previousRectElements[0].type : false,\n      ...fixWidth\n      ? &#123;width: width, boxPadding:0&#125;\n      : &#123;boxPadding: textPadding&#125;\n    &#125;\n  );\n\n  ea.connectObjects(\n    fromElement.id,\n    null,\n    id,\n    null,\n    &#123;\n      endArrowHead: arrowEnd,\n      startArrowHead: arrowStart,\n      numberOfPoints: linePoints\n    &#125;\n  );\n\n  if (previousRectElements.length&gt;0) &#123;\n    const rect = ea.getElement(id);\n    rect.strokeColor = fromElement.strokeColor;\n    rect.strokeWidth = fromElement.strokeWidth;\n    rect.strokeStyle = fromElement.strokeStyle;\n    rect.roughness = fromElement.roughness;\n    rect.roundness = fromElement.roundness;\n    rect.strokeSharpness = fromElement.strokeSharpness;\n    rect.backgroundColor = fromElement.backgroundColor;\n    rect.fillStyle = fromElement.fillStyle;\n    rect.width = fromElement.width;\n    rect.height = fromElement.height;\n  &#125;\n\n  await ea.addElementsToView(false,false);\n&#125; else &#123;\n  id = ea.addText(\n    0,\n    0,\n    text,\n    &#123;\n      wrapAt: wrapLineLen,\n      textAlign: &quot;center&quot;,\n      textVerticalAlign: &quot;middle&quot;,\n      box: &quot;rectangle&quot;,\n      boxPadding: textPadding,\n          ...fixWidth?&#123;width: width&#125;:null\n    &#125;\n  );\n  await ea.addElementsToView(true,false);\n&#125;\n\nea.selectElementsInView([ea.getElement(id)]);\n</code></pre>\n","text":"&#x2F;* This script will prompt you for the title of the process step, then will create a stick note with the text. If an element is selecte...","link":"","photos":[],"count_time":{"symbolsCount":"5.2k","symbolsTime":"5 mins."},"categories":[],"tags":[],"toc":"","author":{"name":"Devmacy","slug":"blog-author","avatar":"https://s1.ax1x.com/2023/01/24/pSYhwB4.jpg","link":"/","description":"数字花园","socials":{"github":"https://github.com/Devmacy","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"Auto Draw for Pen","uid":"e4d1ac459887c21249603be66b9f7f5b","slug":"Auto Draw for Pen","date":"2023-07-29T10:00:19.203Z","updated":"2023-07-29T10:00:19.335Z","comments":true,"path":"api/articles/Auto Draw for Pen.json","keywords":"Digital Garden","cover":null,"text":"&#x2F;*Automatically switches between the select and draw tools, based on whether a pen is being used. Choose the select tool Hover&#x2F;use...","link":"","photos":[],"count_time":{"symbolsCount":"2.3k","symbolsTime":"2 mins."},"categories":[],"tags":[],"author":{"name":"Devmacy","slug":"blog-author","avatar":"https://s1.ax1x.com/2023/01/24/pSYhwB4.jpg","link":"/","description":"数字花园","socials":{"github":"https://github.com/Devmacy","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"Add Link to New Page and Open","uid":"001fd04c919b8fa23e01b328b79ea28a","slug":"Add Link to New Page and Open","date":"2023-07-29T10:00:19.199Z","updated":"2023-07-29T10:00:19.333Z","comments":true,"path":"api/articles/Add Link to New Page and Open.json","keywords":"Digital Garden","cover":[],"text":"&#x2F;* Prompts for filename. Offers option to create and open a new Markdown or Excalidraw document. Adds link pointing to the new file, to...","link":"","photos":[],"count_time":{"symbolsCount":"3.2k","symbolsTime":"3 mins."},"categories":[],"tags":[],"author":{"name":"Devmacy","slug":"blog-author","avatar":"https://s1.ax1x.com/2023/01/24/pSYhwB4.jpg","link":"/","description":"数字花园","socials":{"github":"https://github.com/Devmacy","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}}}