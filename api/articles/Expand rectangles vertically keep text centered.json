{"title":"Expand rectangles vertically keep text centered","uid":"5ca1a57b4a16def73a8a03cc90761396","slug":"Expand rectangles vertically keep text centered","date":"2023-07-29T10:00:19.243Z","updated":"2023-07-29T10:00:19.361Z","comments":true,"path":"api/articles/Expand rectangles vertically keep text centered.json","keywords":"Digital Garden","cover":[],"content":"<p>&#x2F;*</p>\n<p><img src=\"https://raw.githubusercontent.com/zsviczian/obsidian-excalidraw-plugin/master/images/scripts-download-raw.jpg\"></p>\n<p>Download this file and save to your Obsidian Vault including the first line, or open it in “Raw” and copy the entire contents to Obsidian.</p>\n<p><img src=\"https://raw.githubusercontent.com/zsviczian/obsidian-excalidraw-plugin/master/images/scripts-expand-rectangles.gif\"></p>\n<p>This script expands the height of the selected rectangles until they are all the same height and keep the text centered.</p>\n<p>See documentation for more details:<br><a href=\"https://zsviczian.github.io/obsidian-excalidraw-plugin/ExcalidrawScriptsEngine.html\">https://zsviczian.github.io/obsidian-excalidraw-plugin/ExcalidrawScriptsEngine.html</a></p>\n<pre><code class=\"javascript\">*/\n\nconst elements = ea.getViewSelectedElements();\nconst topGroups = ea.getMaximumGroups(elements);\nconst allIndividualArrows = ea.getMaximumGroups(ea.getViewElements())\n    .reduce((result, group) =&gt; (group.length === 1 &amp;&amp; (group[0].type === &#39;arrow&#39; || group[0].type === &#39;line&#39;)) ? \n            [...result, group[0]] : result, []);\n\nconst groupHeights = topGroups\n  .map((g) =&gt; &#123;\n    if(g.length === 1 &amp;&amp; (g[0].type === &#39;arrow&#39; || g[0].type === &#39;line&#39;)) &#123;\n      // ignore individual lines\n      return &#123; minTop: 0, maxBottom: 0 &#125;;\n    &#125;\n    return g.reduce(\n      (pre, cur, i) =&gt; &#123;\n        if (i === 0) &#123;\n          return &#123;\n            minTop: cur.y,\n            maxBottom: cur.y + cur.height,\n            index: i,\n          &#125;;\n        &#125; else &#123;\n          return &#123;\n            minTop: cur.y &lt; pre.minTop ? cur.y : pre.minTop,\n            maxBottom:\n              cur.y + cur.height &gt; pre.maxBottom\n                ? cur.y + cur.height\n                : pre.maxBottom,\n            index: i,\n          &#125;;\n        &#125;\n      &#125;,\n      &#123; minTop: 0, maxBottom: 0 &#125;\n    );\n  &#125;)\n  .map((r) =&gt; &#123;\n    r.height = r.maxBottom - r.minTop;\n    return r;\n  &#125;);\n\nconst maxGroupHeight = Math.max(...groupHeights.map((g) =&gt; g.height));\n\nfor (var i = 0; i &lt; topGroups.length; i++) &#123;\n  const rects = topGroups[i]\n    .filter((el) =&gt; el.type === &quot;rectangle&quot;)\n    .sort((lha, rha) =&gt; lha.y - rha.y);\n  const texts = topGroups[i]\n    .filter((el) =&gt; el.type === &quot;text&quot;)\n    .sort((lha, rha) =&gt; lha.y - rha.y);\n  const groupWith = groupHeights[i].height;\n  if (groupWith &lt; maxGroupHeight) &#123;\n    const distance = maxGroupHeight - groupWith;\n    const perRectDistance = distance / rects.length;\n    const textsWithRectIndex = [];\n    for (var j = 0; j &lt; rects.length; j++) &#123;\n      const rect = rects[j];\n      const rectLeft = rect.x;\n      const rectTop = rect.y;\n      const rectRight = rect.x + rect.width;\n      const rectBottom = rect.y + rect.height;\n\n      const textsWithRect = texts.filter(text =&gt; text.x &gt;= rectLeft &amp;&amp; text.x &lt;= rectRight\n        &amp;&amp; text.y &gt;= rectTop &amp;&amp; text.y &lt;= rectBottom);\n\n      textsWithRectIndex[j] = textsWithRect;\n    &#125;\n    for (var j = 0; j &lt; rects.length; j++) &#123;\n      const rect = rects[j];\n      rect.y = rect.y + perRectDistance * j - perRectDistance / 2;\n      rect.height += perRectDistance;\n\n      const textsWithRect = textsWithRectIndex[j];\n      \n      if(textsWithRect) &#123;\n        for(const text of textsWithRect) &#123;\n          text.y = text.y + perRectDistance * j;\n        &#125;\n      &#125;\n\n      // recalculate the position of the points\n      const startBindingLines = allIndividualArrows.filter(el =&gt; (el.startBinding||&#123;&#125;).elementId === rect.id);\n         for(startBindingLine of startBindingLines) &#123;\n             recalculateStartPointOfLine(startBindingLine, rect);\n         &#125;\n     \n         const endBindingLines = allIndividualArrows.filter(el =&gt; (el.endBinding||&#123;&#125;).elementId === rect.id);\n         for(endBindingLine of endBindingLines) &#123;\n             recalculateEndPointOfLine(endBindingLine, rect);\n         &#125;\n    &#125;\n  &#125;\n&#125;\n\nea.copyViewElementsToEAforEditing(elements);\nawait ea.addElementsToView(false, false);\n\nfunction recalculateStartPointOfLine(line, el) &#123;\n    const aX = el.x + el.width/2;\n    const bX = line.x + line.points[1][0];\n    const aY = el.y + el.height/2;\n    const bY = line.y + line.points[1][1];\n\n    line.startBinding.gap = 8;\n    line.startBinding.focus = 0;\n    const intersectA = ea.intersectElementWithLine(\n                el,\n                [bX, bY],\n                [aX, aY],\n                line.startBinding.gap\n              );\n\n    if(intersectA.length &gt; 0) &#123;\n        line.points[0] = [0, 0];\n        for(var i = 1; i&lt;line.points.length; i++) &#123;\n            line.points[i][0] -= intersectA[0][0] - line.x;\n            line.points[i][1] -= intersectA[0][1] - line.y;\n        &#125;\n        line.x = intersectA[0][0];\n        line.y = intersectA[0][1];\n    &#125;\n&#125;\n\nfunction recalculateEndPointOfLine(line, el) &#123;\n    const aX = el.x + el.width/2;\n    const bX = line.x + line.points[line.points.length-2][0];\n    const aY = el.y + el.height/2;\n    const bY = line.y + line.points[line.points.length-2][1];\n\n    line.endBinding.gap = 8;\n    line.endBinding.focus = 0;\n    const intersectA = ea.intersectElementWithLine(\n                el,\n                [bX, bY],\n                [aX, aY],\n                line.endBinding.gap\n              );\n\n    if(intersectA.length &gt; 0) &#123;\n        line.points[line.points.length - 1] = [intersectA[0][0] - line.x, intersectA[0][1] - line.y];\n    &#125;\n&#125;\n</code></pre>\n","text":"&#x2F;* Download this file and save to your Obsidian Vault including the first line, or open it in “Raw” and copy the entire contents to Obs...","link":"","photos":[],"count_time":{"symbolsCount":"5.3k","symbolsTime":"5 mins."},"categories":[],"tags":[],"toc":"","author":{"name":"Devmacy","slug":"blog-author","avatar":"https://s1.ax1x.com/2023/01/24/pSYhwB4.jpg","link":"/","description":"数字花园","socials":{"github":"https://github.com/Devmacy","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"Expand rectangles vertically","uid":"aa20de198c42e0389715b5676ed68a33","slug":"Expand rectangles vertically","date":"2023-07-29T10:00:19.245Z","updated":"2023-07-29T10:00:19.362Z","comments":true,"path":"api/articles/Expand rectangles vertically.json","keywords":"Digital Garden","cover":[],"text":"&#x2F;* Download this file and save to your Obsidian Vault including the first line, or open it in “Raw” and copy the entire contents to Obs...","link":"","photos":[],"count_time":{"symbolsCount":"4.4k","symbolsTime":"4 mins."},"categories":[],"tags":[],"author":{"name":"Devmacy","slug":"blog-author","avatar":"https://s1.ax1x.com/2023/01/24/pSYhwB4.jpg","link":"/","description":"数字花园","socials":{"github":"https://github.com/Devmacy","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"Expand rectangles horizontally","uid":"ef1414d6c8c88e321fce206638187e24","slug":"Expand rectangles horizontally","date":"2023-07-29T10:00:19.241Z","updated":"2023-07-29T10:00:19.360Z","comments":true,"path":"api/articles/Expand rectangles horizontally.json","keywords":"Digital Garden","cover":[],"text":"&#x2F;* Download this file and save to your Obsidian Vault including the first line, or open it in “Raw” and copy the entire contents to Obs...","link":"","photos":[],"count_time":{"symbolsCount":"4.4k","symbolsTime":"4 mins."},"categories":[],"tags":[],"author":{"name":"Devmacy","slug":"blog-author","avatar":"https://s1.ax1x.com/2023/01/24/pSYhwB4.jpg","link":"/","description":"数字花园","socials":{"github":"https://github.com/Devmacy","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}}}